									基于Linux的网络攻击与防御



									       摘要

			随着云计算开始出现在大家的视线里，越来越多的传统行业在转型，越来越多的传统行
		 业开始相信云，开始“上云”，那么网络作为云的基础及必备条件，安全问题一直是各大
		 云计算厂商要致力解决的问题，这里的网络安全包括局域网安全，广域网安全等。现在
		 要做的不仅仅是要能否发现攻击而且要能抵御攻击，甚至是在攻击发生之前就能探测到
		 攻击即将来临。对于局域网安全方面也是尤为重要，我们知道在像阿里云ECS这样的产品
		 线，一台ECS云主机在拥有外网带宽的情况下会有一个外网IP和内网IP，外网IP只全球唯
		 一的，内网IP是10开头的局域网IP，在内部主机交互时用到，因为阿里云致力于打造一个
		 闭环生态系统，致力于阿里云一家就能提供一站式行业问题解决方案，所以只要提供一个
		 外网出口，其余计算及网络交互全在阿里云内部系统完成，此时局域网安全会变的异常重
		 要，因为每台主机都是向外租用，无法保证开发者在上面做了什么，从安全的角度来说我
		 们必须去假设所有的开发者在上面做最坏的事情。所以局域网内的安全就显的尤为重要，
		 像这样的大系统不仅仅要能够发现内部攻击而且要能够主动防御，在攻击开始或者即将发
		 生就将攻击扼杀在摇篮中。所以对于局域网内的安全研究是非常重要的。由于在局域网内
		 的一些底层协议天生就存在一些缺陷，攻击者很容易利用这些缺陷进行攻击，窃取一些敏感
		 信息，造成经济损失。此篇论文会在原有攻击基础上对当前流行的一些云产品进行攻击及
		 相应权限获取，最后从源头上提出防御方案。


		 关键字：Linux; TCP/IP; ARP; driftnet; ettercap; 中间人; cookie; Libnet; Libpcap;
				

		 1 前言
		 1.1 研究背景
			随着网络设备的能力增强，大型局域网越来越多，会有更多的用户及网络设备处于同一
		局域网内，也就是说在同一网络中会有更多的用户数据在此局域网内流动。之前的很长一段时间
		通常是一个家庭共享一个局域网，那么在局域网内的一些数据无需进行保密也无需担心窃取，
		这种用户互信的网络不用担心局域网安全问题，但是随着局域网越来越大，很多情况是一个大实验室
		一个小区，甚至是一个学校共用一个大型局域网，局域网中接入的不同网络设备越来越多，每个
		接入局域网的用户是互不认识，如果在此类型网络中有恶意设备接入，或有恶意攻击者的存在将会
		导致局域网的安全性问题，尤其是在这个网络环境中没有高水平的管理员的情况下就很容易造成
		局域网内产生的攻击长期不被发现，造成局域网内用户在网络上传输的数据长期被监视。当前
		整个互联网上80%左右的数据流量都是由http产生，由于用https进行加密会造成大量客户端及
		服务器端加解密的大量CPU资源消耗，很多web服务器并没有提供https访问，这就造成大量个人
		私有数据是在局域网内以明文传输，这样有心人就可以利用这点通过网络嗅探或中间人攻击等
		技术来获取特定用户在网络上传输的数据。我们知道并不是所有人都理解网络，局域网中的用户
		大多数都是网络小白，不知道甚至没有网络安全的意识，他们会有意无意的将自己的数据用http
		以明文的形式发送到网络中，如果这些数据很机密，或者存在很大的潜在价值就很有可能被有心人
		窃取造成信息泄漏，因此会造成大量经济损失和犯罪。因此在局域网内的安全要格外重视，一不
		小心就可能让有心人拿到你的私人信息，如果对方是白帽子还好，如果是黑帽子就及有可能会
		将你一些不为人知的秘密公开。

		 1.2 主要研究内容
			ARP是局域网内最基础也是最重要的网卡与网卡之间的通信协议，由于一般一台主机配备一块
		或多块网卡，所以ARP也是主机之间底层网络的一个通信协议。我们知道像ARP这种用于局域网内的
		通信协议是一种无状态的协议，不像TCP那样复杂，更没有什么端口的概念，所以想向某台主机的
		网卡发送伪造的ARP请求或应答报文是非常容易的，由于没有状态，在构造数据包及向受害主机发送
		的时候更本就不需要什么前奏，因此造成的结果是在局域网内进行ARP攻击非常容易。这篇论文以
		ARP攻击为基础，在拿到目标主机或者说整个局域网内所有主机在网络上传输的数据后，根据自己
		的需要过滤出感兴趣的一部分数据进行相应的账户窃取，数据恶意修改，对目标主机行为进行监视。
		具体研究及工作如下：
			（1）研究ARP欺骗攻击的原理，借助工具实现ARP攻击及自行编写代码构造数据包两种方式实现
		ARP中间人攻击。主要目的是学习底层网络的数据传输模式，及一些基本的底层网络数据传输知识。

			（2）在ARP欺骗攻击成功的情况下对网络数据进行嗅探，拿到发往阿里云OSS的HTTP请求数据包
		头部，通过程序分析请求类型，请求产生什么样的效果，并对HTTP请求头部进行改造，完成之后将请求
		像aliyun OSS集群重放此请求，达到恶意数据篡改的效果，并在此过程中演示一些存放在OSS上的可执行
		文件的一些修改，进而实现恶意程序的植入。

			（3）同样在ARP欺骗攻击的基础上捕获到某主机与百度云的交互，由于百度云是以HTTP协议作为数据
		的载体，以明文发送，因此只要能拿到HTTP请求中的cookie，并借助firefox的提供的开源cookie注入插件
		在每次向百度云发送请求的时候将指定cookie注入到HTTP请求头部中去，就能够达到身份伪造的目的，进而
		对被攻击者进行身份顶替，获取所有增删改查操作权限，百度云用户很多，百度也很慷慨，给了用户大量
		免费空间，很多用户将自己几乎所有重要的文件都备份到百度云中，因此拿到百度云的操作权限基本上就
		拿到了攻击者的所有电子秘密。当然除了百度云国内还有很多家网站可以通过这种方式进行攻击，这里选择
		百度云的原因是百度云拥有的用户量最多，拿到相应的操作权限后得到的数据最多，回报最大。

			（4）对特定主机，或整个网络上的数据进行监视，获取网络上的一些图片、音频、视频等流媒体文件
		并在本机实时播放，借此可以监视受害者几乎一切操作行为而无需拿到其主机的操作权限。在此攻击过程中
		会借助开源工具driftnet进行实现，在实验过程中对源码进行分析，并修改其源码增加一些笔者需要的功能
		并借此机会学习网络监视程序的架构及实现方式，最重要的是通过工具分析网络包的方式来直观体会下网络
		协议栈的工作模式，在工具对数据包进行剥离的时候掌握协议栈的拆解包模式，并借此提高自己的源码阅读
		能力。


			（5）研究一些开源网络库的使用方式，如进行网络请求收发的Libcurl，进行底层网络数据包捕获
		的Libpcap，进行网络数据包构造及发送的libnet等开源网络库，在熟悉其使用方式后分析其源码。

			（6）研究Linux下一些常用网络工具的使用方式，在使用过程中通过阅读源码等方式来进一步研究其底
		层实现方式，这些工具包括nmap、ettercap、netstat、ifstat、tcpdump、wireshark等。
			
			（7）对局域网内的ARP协议进行防御，给出一些现存已有优秀的一些防御方式，并给出部分实现。
