					检测 ARP 欺骗攻击 ：主动防御技术
					Vivek Ramachandran1 and Sukumar Nandi2
					Cisco Systems, Inc., Bangalore India
	摘要. 由于地址解析协议（ARP）的无状态性和缺乏对发送者的身份验证机制，已长期被用于ARP欺骗攻击。
有时候APR欺骗攻击通常是针对于复杂局域网进行攻击类似于拒绝服务、中间人攻击和会话劫持。当前监测ARP欺骗
攻击用的都是些被动方式，监测局域网中的ARP报文查找易变的以太网地址和IP映射。被动防御方式的主要缺点在于
APR学习和检测到攻击的时差，有时会导致在攻击进行很长一段时间后才被发现。在这篇论文中，我们给出一个主动
监测ARP欺骗攻击的技术。我们注入ARP请求报文和TCP SYN报文到网络中来探测不正常的MAC地址与IP映射。这种技术
相比于被动防御方式更快、更智能、扩展性更强，在监测ARP攻击上更可靠。这种技术能够检测到正确的MAC和IP的映射
关系从而增加ARP攻击被检测出来的精确及可靠性。
1 介绍
	ARP协议是局域网内最基础但是非常重要的通信协议之一。ARP协议用来解析MAC地址与主机IP的对应关系。这是通过
发送特定ARP请求报文（广播）到网络中来完成。相对应的主机回复携带自己正确的MAC地址与IP的ARP应答报文（单播）。
在某些情况下主机会发送ARP报文广播自己的MAC地址。所有的主机都会维护一份ARP缓存保存从网络上学习到的（动态项（
MAC的地址映射或是管理员配置的映射关系（静态项）。动态项会在一定的时间后过期，这个过期时间因操作系统的实现
方式不同而不同。在这些条目过期之后会从ARP缓存中删除，如果此时主机想于其他在同一局域网内机器通信，额外的ARP
请求报文会发出去。静态项永远不会过期。针对ARP协议的更详细讨论详见［1］。
	ARP协议是无状态的，主机会缓存所有发送给他的ARP应答消息即使不是明确请求的ARP应答。在大多数操作系统中即使
是之前的没有过期的动态ARP表项会被新来的ARP报文携带的信息覆盖。由于没有采取任何验证机制，所有的主机盲目的缓
存收到的ARP应答，这才是导致ARP欺骗攻击发生的根源。
	ARP欺骗是伪造受害者主机构造ARP报文发送到局域网中。在最常见的ARP攻击形式中，攻击者会周期性的发送ARP
应答报文欺骗受害者主机。这会保证局域网中的其它机器永远不会发送ARP请求报文去请求被攻击的主机的IP与地址映射
关系。下面一节将简短的讨论当前检测和预防ARP攻击技术。
1.1 时下缓和及侦测技术
	现存的ARP欺骗检测技巧在下面几个小结将被讨论。
1.1.1 安全 ARP 协议（S-ARP）
	这已经被建议作为现存ARP协议的替代协议，详见［10］. S-ARP是定义为一个永久ARP欺骗攻击解决方案，但是最大的
缺点是我们必须更改网络上所有主机的协议栈。这并不是高可扩展的解决方案去让所有操作系统和硬件提供商及所有的客户
去升级他们系统，他们不会乐于这样做。由于S-ARP使用了数字签名算法（DSA）我们还有其它的很多任务要去看一些
关于加密的论文，不过在这里介绍显然是没意义的。
1.1.2 静态MAC项
	为每一台主机增加静态MAC地址项就不会有任何欺骗攻击的存在，但是这种解决方案在管理所有静态项的时工作量太大。
而其这种方式很不幸的在大量移动主机不定期介入的时侯更不可行，例如笔记本。一些操作系统在收到自主ARP报文（GARP）
的时候会更新静态ARP项。
1.1.3 基于内核补丁
	基于内核的补丁，像Anticap［11］和Antidote［12］已经对ARP欺骗攻击在自身主机层面进行保护。Anticap［11］
在接收到承载不同的MAC与IP映射ARP应答报文的时候不允许更新没有过期的ARP缓存这个很不幸的让合法自主ARP报文也被
丢弃，这违反了ARP协议的一些特性［1］，Antidote［12］在接收到一个ARP应答报文的时候如果报文承载的内容和之前
缓存的内容不同的花就会尝试检查之前学习到的MAC是否依然存活。如果之前学习到的MAC地址依然存在就拒绝更新缓存
而其将违规的MAC地址加入到地址黑名单中。
	以上两种技术依赖于ARP缓存中的映射关系合法的情况下。这就在攻击者和受害者之前产生了一个竞争关系。如果
攻击者攻击者让其伪造的ARP项进入到主机缓存先于真实项，那么真实MAC地址就会被禁止。这种情况发生只能在系统
管理员的干涉下才能解决。因此我们可以得处错误的学习方式可能会导致这些攻击在检测ARP攻击时候失败。
1.1.4 被动检测
	在被动检测中，我们嗅探到网络上的ARP请求/应答包然后建立MAC与IP映射关系库。如果我们注意到任何MAC地址和
IP映射关系的变化后就开始报警认为ARP欺骗攻击正在进行。用这种方法实现的最著名的工具是ARPWATCH［9］。
	被动检测的主要缺点在于学习地址映射关系和检测到攻击的时差。第一次在工具运行之前攻击已经开始的情况下
检测工具会学习到虚假的ARP应答报文将虚假的MAC与IP映射关系入库。现在只有在受害者开始与其它主机通信的时候
MAC与IP对应关系的不一致才会被发现，报警才会出现。攻击着可能利用这个时差已经逃离。上述场景中学习到
的虚假ARP项将不得不由网络管理员手动解除才行。解决这个问题的唯一方式之后手动的去纠正并录入正确的地址映射
关系到数据库中在启动ARP欺骗攻击检测工具之前。所有的这些无论是在扩展性还是灵活性上都是不合理的。一个典型
的例子是移动设备介入，例如来公司的客户或参观者携带的笔记本。这样慢的学习曲线导致不可能在一个大型网路中
（1000+ hosts）安装被动检测工具并同时希望能检测出攻击的存在。
	被动检测技术一点也不智能，盲目的查找网络中的ARP应答与本地数据库中不匹配的ARP表项。如果ARP攻击被检测
到也没有办法查明最新看到的MAC与IP映射是真是假，因为无法保证之前学习到的映射关系的真假。我们的技术将会
得到真实的MAC和IP的对应关系即使在攻击进行中，从而给保证了检测的准确性。
	被动学习技术也非常不可靠。在ARP流量被看见的时候一个新地址映射关系会被学习。因此一个交换机的ARP缓
存在存储大量条目后会溢出。攻击者每秒尝试产生随机的ARP应答包承载任意的MAC和IP地址映射，这将会导致缓存
溢出而非汇报攻击的出现。为了克服早期防疫技术的缺陷，我们给出一个新的ARP欺骗攻击见车技术。我们的技术
采取主动方式去检测ARP欺骗攻击。我们发送我们的ARP请求和TCP SYN包来探测网络上ARP流量的合法性。这种方式
相比于被动方式更快，更智能，扩展性更强也更可靠。也能附加的检测到正确的IP与MAC的映射关系从而增加侦测到
真实攻击的准确性。接下来的几节将会用来描述这个技术。


	 
